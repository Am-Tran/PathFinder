import pandas as pd

# 1. On charge votre fichier historique
chemin = "data/enriched/offres_apec_full.csv"
print(f"üìÇ Lecture de : {chemin}")

try:
    # On essaie de lire (parfois le s√©parateur est ; et pas ,)
    df = pd.read_csv(chemin, sep=None, engine='python')
    print("‚úÖ Fichier lu avec succ√®s.")
    print(f"Colonnes trouv√©es : {df.columns.tolist()}")
    
    # On cherche la colonne URL
    col_url = None
    if 'URL' in df.columns: col_url = 'URL'
    elif 'url' in df.columns: col_url = 'url'
    
    if col_url:
        first_saved_url = df[col_url].iloc[0]
        print(f"\nüßê EXEMPLE D'URL DANS LE FICHIER (M√©moire) :")
        print(f"'{first_saved_url}'") # Les guillemets montrent les espaces cach√©s
        
        # Simulation d'une URL scrap√©e (format standard Apec)
        exemple_scraped = "https://www.apec.fr/candidat/recherche-emploi.html/emploi/detail-offre/123456789W"
        
        print("\nüîé ANALYSE :")
        if "www.apec.fr" not in str(first_saved_url):
            print("‚ö†Ô∏è PROBL√àME D√âTECT√â : Les URLs stock√©es semblent relatives (elles n'ont pas le d√©but https://...)")
        elif len(str(first_saved_url)) > 150:
            print("‚ö†Ô∏è PROBL√àME D√âTECT√â : Les URLs stock√©es contiennent des param√®tres de tracking trop longs.")
        else:
            print("Le format semble correct √† premi√®re vue. Le probl√®me est subtil.")
            
    else:
        print("‚ùå ERREUR : Pas de colonne URL trouv√©e. V√©rifiez la casse (majuscule/minuscule).")

except Exception as e:
    print(f"‚ùå Erreur lecture : {e}")